<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> CyberIntruder | Blog </title> <meta name="author" content="CyberIntruder - Molx32 "/> <meta name="description" content="This post is an introduction that describes the business environment"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚛️</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://cyber-intruder.com/blog/2022/Update-management-00/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://cyber-intruder.com/">CyberIntruder</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/about">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/fr-fr/blog/2022/Update-management-00/"> FR-FR </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Azure Update Management - Part 0 - Introduction</h1> <p class="post-meta">August 1, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/updatemanagement"> <i class="fas fa-hashtag fa-sm"></i> updatemanagement</a>   </p> </header> <article class="post-content"> <p><i>Hello there, the goal of this serie is to describe a real world implementation of <b>Azure Update Management</b>. This service was designed to update any machine in your infrastructure, whether they are hosted on Azure or elsewhere, provided your OSs are technically supported.</i></p> <p><i>In order for every reader to understand and find answers to their need, to I’ll try to give a comprehensive feedback from my experience, as well as sharing tips about design and architecture, automation, effectivement, troubleshooting issues, and so on!</i></p> <p><i>Have a nice reading.</i></p> <hr> <h4 id="plan">Plan</h4> <ul> <li><b><a href="/blog/2022/Update-management-00/">Part 0 - Introduction (you’re here)</a></b></li> <li><a href="/blog/2022/Update-management-01/">Part 1 - Architecture</a></li> <li><a href="/blog/2022/Update-management-011/">Part 2 - Azure Policy</a></li> <li><a href="/blog/2022/Update-management-02/">Part 3 - Azure ARC</a></li> <li><a href="/blog/2022/Update-management-03/">Part 4 - Log Analytics agents</a></li> <li><a href="/blog/2023/Update-management-04/">Part 5 - Automation accounts</a></li> <li><a href="/blog/2023/Update-management-05/">Part 6 - Monitoring</a></li> <li><a href="/blog/2023/Update-management-06/">Part 7 - Security patches on Azure ARC</a></li> <li><a href="/blog/2023/Update-management-07/">Part 8 - Security patches on CentOS machines</a></li> </ul> <hr> <h2 id="introduction">Introduction</h2> <p>I worked for the past year as an Operational Security Engineer on Azure Update Management. Since my client was a big international retail company, their IT environment was heterogeneous, with many and various constraints that made the work more complicated. Since I spent a lot of time in this project, and because I face complex use cases, I decided to share my experience and maybe save you some time if you also try to setup the solution.</p> <p>Of course, I will present the solution I presented, and you may work on a different architecture, but I hope that many things could be used in any context.</p> <h2 id="scenario">Scenario</h2> <p>This scenario may differ from your use cases, but keep in mind that this is a real world scenario! Thus, you may find interesting tips and information to build a service that fits your needs. Because it is an overview, you will find a lot of information in this section, and you may not have a clear picture of how to set up all of this. Don’t worry, technical stuff will be described in the next posts.</p> <h3 id="update-policy">Update policy</h3> <p>It is important that you define an update policy in the early stage of the project. In my case, the update policy is the following :</p> <ol> <li> <b>We want to apply only security or critical patches.</b> Here are the descriptions of each type, from the <a href="https://docs.microsoft.com/en-us/troubleshoot/windows-client/deployment/standard-terminology-software-updates" target="_blank" rel="noopener noreferrer">Microsoft documentation</a> <ul> <li> <i>Critical updates</i> - A widely released fix for a specific problem that addresses a critical, non-security-related bug.</li> <li> <i>Security updates</i> - An update that collects all the new security updates for a given month and for a given product, addressing security-related vulnerabilities. It’s distributed through Windows Server Update Services (WSUS), System Center Configuration Manager and Microsoft Update Catalog. Security vulnerabilities are rated by their severity. The severity rating is indicated in the Microsoft security bulletin as critical, important, moderate, or low. This Security-only update would be displayed under the title Security Only Quality Update when you download or install the update. It will be classified as an Important update.</li> </ul> </li> <li> <b>We want to apply those patches once a week.</b> This can be considered being a high update frequency : the reason of this choice is that the security team required defined SLA to handle and mitigate vulnerabilities, based on their <a href="https://www.first.org/cvss/" target="_blank" rel="noopener noreferrer">CVSS</a>. By applying patches once a week, we ensure that critical vulnerabilities that need a patch will be patched within a week. <ul> <li>For a vulnerability with CVSS &gt; 10, remediate as soon as possible</li> <li>For a vulnerability with CVSS &gt;= 9, remediate within 2 weeks</li> <li>For a vulnerability with CVSS &gt;= 7, remediate within 3 months</li> <li>For a vulnerability with CVSS &lt; 7, remediate within 6 months</li> </ul> </li> <li> <p><b>We want to reboot only if needed.</b> One of the major constraints regarding patches is the need to reboot the VM to apply patches, because servers may host critical business applications and must provide a service continuity. Altough security patches usually don’t require to reboot servers, it is still necessary to define maintenance schedules i.e. a timeframe when we can reboot the server. In our case the maintenance schedule will last 2 hours. If the machine can’t update during this timeframe, then the patching process is stopped.</p> </li> <li> <b>We want to update only backuped machines.</b> In the case the applied updates have a side effect, we want to make sure that all the machines are backuped, so we can rollback any time. A concrete example on Windows Server 2016 is the <b><a href="https://learn.microsoft.com/en-us/troubleshoot/azure/virtual-machines/unresponsive-vm-apply-windows-update#resolution" target="_blank" rel="noopener noreferrer">C01A001D</a>.</b> </li> </ol> <p><u>Note</u> : it is important to keep in mind that update management is not the one and only solution to keep your VMs safe. Indeed, OS may no longer be supported, and vulnerabilities must sometimes be mitigated by configuring specific settings rather than updating the machine.</p> <h3 id="environment">Environment</h3> <p>In this scenario, we assume we have about a thousand servers distributed across Azure and multiple other cloud or non-cloud environments (OCI, OVH, GCP, On-premise, etc.). Since Update management is an Azure service, you may think that this is easier to set up for Azure VM, and this is true.</p> <ul> <li>For Azure VMs, we only need to deploy an agent, the <i>Log Analytics agent</i> on the machine to collect its logs and know which updates are missing.</li> <li>For non Azure VMs, we first need to establish a link between the VM and Azure using the Azure ARC agent, so that it can be managed like any other resource from Azure. Once this is done, the we only also to deploy the <i>Log Analytics agent</i>, just like Azure VMs.</li> </ul> <p>In terms of OSs, You can find a list of supported OS in the <a href="https://docs.microsoft.com/en-us/azure/automation/update-management/operating-system-requirements" target="_blank" rel="noopener noreferrer">Microsoft documentation</a>.</p> <table id="custom" class="t-border"> <tr> <th>Windows OS</th> <th>Linux OS</th> </tr> <tr> <td>Windows Server 2019</td> <td>CentOS 6, 7, and 8</td> </tr> <tr> <td>Windows Server 2016</td> <td>Oracle Linux 6.x, 7.x, 8x</td> </tr> <tr> <td>Windows Server 2012 R2</td> <td>Red Hat Enterprise 6, 7, and 8</td> </tr> <tr> <td>Windows Server 2012</td> <td>SUSE Linux Enterprise Server 12, 15, and 15.1</td> </tr> <tr> <td>Windows Server 2008 R2</td> <td>Ubuntu 14.04 LTS, 16.04 LTS, 18.04 LTS, and 20.04 LTS</td> </tr> </table> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 CyberIntruder - Molx32 . </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-MFVVRMM3DK"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-MFVVRMM3DK");</script> </body> </html>